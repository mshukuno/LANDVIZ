(function(a){a.landisSettings=function(){this.set=function(){this.init=true;var b;if(!((b=getUrlParameter("s"))&&(this.settings=loadJson("config/"+b+".json")))){this.settings=loadJson("config/default_settings.json");if(!this.settings){alert("bad settings file")}}return this};this.setProjectName=function(){if(this.settings.hasOwnProperty("projectname")){a("#ProjectName > h1").text(this.settings.projectname)}};if(this.init){return new a.landisSettings()}else{this.set();return this}}})(jQuery);(function(a){a.landisMetadata=function(){this.set=function(){this.init=true;var b=landisSettings.settings.landisdata.path+"/"+landisSettings.settings.landisdata.metadata;this.scenarios=loadJson(b+"/metadata.scenarios.json");this.extensions=loadJson(b+"/metadata.extensions.json");return this};this.publishScenarios=function(b){var d={};if(b){for(scenario in this.scenarios.scenarios){d[scenario]={};for(attr in b){if(this.scenarios.scenarios[scenario][b[attr]]){d[scenario][b[attr]]=this.scenarios.scenarios[scenario][b[attr]]}}}return d}else{return this.scenarios.scenarios}};this.getScenarioAttributeById=function(d,b){return this.scenarios.scenarios[d][b]};this.getExtensionAttributeById=function(d,b){return this.extensions[d][b]};this.getExtensionAttributesById=function(b){console.log(this.extensions[b])};this.getOutputAttributeById=function(d,e,b){return this.extensions[d].outputs[e][b]};this.getFieldAttributeById=function(e,f,d,b){return this.extensions[e].outputs[f].fields[d][b]};this.publishExtensions=function(){console.log(this.extensions);return this};this.publishMapOutputs=function(){var d,b={};for(d in this.extensions){b[d]={};b[d].extensionId=this.extensions[d].extensionId;b[d].extensionName=this.extensions[d].extensionName;b[d].outputs={};for(output in this.extensions[d].outputs){if((this.extensions[d].outputs[output].outputType).toLowerCase()==="map"){b[d].outputs[output]={};b[d].outputs[output].outputId=this.extensions[d].outputs[output].outputId;b[d].outputs[output].outputName=this.extensions[d].outputs[output].outputName}}if(a.isEmptyObject(b[d].outputs)){delete b[d]}}return b};this.publishTableOutputs=function(){var d,b={};for(d in this.extensions){b[d]={};b[d].extensionId=this.extensions[d].extensionId;b[d].extensionName=this.extensions[d].extensionName;b[d].outputs={};for(output in this.extensions[d].outputs){if((this.extensions[d].outputs[output].outputType).toLowerCase()==="table"){b[d].outputs[output]={};b[d].outputs[output].outputId=this.extensions[d].outputs[output].outputId;b[d].outputs[output].outputName=this.extensions[d].outputs[output].outputName;b[d].outputs[output].fields=this.extensions[d].outputs[output].fields}}if(a.isEmptyObject(b[d].outputs)){delete b[d]}}return b};if(this.init){return new a.landisMetadata()}else{this.set();return this}}})(jQuery);(function(a){a.landisMaps=function(){this.set=function(){this.init=true;this.mapGroups=[];this.mapGroupsByUnit={};return this};this.checkMapCandidates=function(b){var f,d,g=[],j;for(m in this.mapGroups){d=-1;for(c in b){if(b[c].extension==this.mapGroups[m].extension&&b[c].output==this.mapGroups[m].output){d=c;break}}if(d===-1){g.push(m)}}g.sort();g.reverse();for(map in g){console.log(g[map]);this.mapGroups[g[map]].rasterMapGroup.rastermapgroup("destroy");this.mapGroups.splice(g[map],1)}for(c in b){d=-1;for(f=0;f<this.mapGroups.length;f++){if(b[c].extension==this.mapGroups[f].extension&&b[c].output==this.mapGroups[f].output){d=f;break}}if(d>-1){this.mapGroups[d].rasterMapGroup.rastermapgroup("updateRasterMaps",b[c].scenarios);arrangeApplicationData();this.mapGroups[d].rasterMapGroup.rastermapgroup("loadStatsForMapsInMapGroup");this.mapGroups[d].rasterMapGroup.rastermapgroup("updateMinMax")}else{this.mapGroups.push(b[c]);j=this.mapGroups[this.mapGroups.length-1];var h=j.extension,k=j.output;j.rasterMapGroup=a("<div>").rastermapgroup({extensionName:landisMetadata.getExtensionAttributeById(h,"extensionName"),outputName:landisMetadata.getOutputAttributeById(h,k,"outputName"),extensionId:landisMetadata.getExtensionAttributeById(h,"extensionId"),outputId:landisMetadata.getOutputAttributeById(h,k,"outputId"),unit:landisMetadata.getOutputAttributeById(h,k,"unit"),scenarios:j.scenarios,timeInterval:landisMetadata.getExtensionAttributeById(h,"timeInterval"),dataType:landisMetadata.getOutputAttributeById(h,k,"dataType"),hiddenUIContainer:"#HiddenUIContainer"}).appendTo("#MapContainer");arrangeApplicationData();j.rasterMapGroup.rastermapgroup("drawRasterMaps");j.rasterMapGroup.rastermapgroup("loadStatsForMapsInMapGroup");arrangeApplicationData();j.rasterMapGroup.rastermapgroup("drawMapLegend")}}a(".map-group").rastermapgroup("updateSizeOfMaps");arrangeApplicationData()};this.bindViewsToFirstMap=function(){var d,b,e=[];if(this.mapGroups.length>0){for(d=0;d<this.mapGroups.length;d++){e.push(this.mapGroups[d].rasterMapGroup.rastermapgroup("getAllMapObjects"))}if(e[0].length>1){d=0;b=1}else{d=1;b=0}for(d;d<e.length;d++){for(b;b<e[d].length;b++){e[d][b].bindTo("view",e[0][0])}b=0}}};this.updateColorRamp=function(g){var f,e,b,k,l=[],h,d;for(f=0;f<this.mapGroups.length;f++){if(this.mapGroups[f].rasterMapGroup.rastermapgroup("getMapGroupId")==g){k=this.mapGroups[f].rasterMapGroup.rastermapgroup("option","unit");if(mapSync&&this.mapGroupsByUnit.hasOwnProperty(k)){h=this.mapGroups[f].rasterMapGroup.rastermapgroup("getMapGroupLegend");d=h.mapLegend("getWebGlColorRamp");for(e=0;e<this.mapGroupsByUnit[k].length;e++){l=this.mapGroups[this.mapGroupsByUnit[k][e]].rasterMapGroup.rastermapgroup("getRasterMaps");for(b=0;b<l.length;b++){l[b].rastermap("updateTimeSeriesLayerColorRamp",d)}}}else{this.mapGroups[f].rasterMapGroup.rastermapgroup("updateColorRamp")}break}}};this.updateMinMax=function(k){var h,g,d,n,b=[],o,e,l,f;for(h=0;h<this.mapGroups.length;h++){if(this.mapGroups[h].rasterMapGroup.rastermapgroup("getMapGroupId")==k){this.mapGroups[h].rasterMapGroup.rastermapgroup("filterMinMax");n=this.mapGroups[h].rasterMapGroup.rastermapgroup("option","unit");if(mapSync&&this.mapGroupsByUnit.hasOwnProperty(n)){o=this.mapGroups[h].rasterMapGroup.rastermapgroup("getMapGroupLegend");e=o.mapLegend("option","filterMin");l=o.mapLegend("option","filterMax");f=this.mapGroups[h].rasterMapGroup.rastermapgroup("getMinMax");for(g=0;g<this.mapGroupsByUnit[n].length;g++){b=this.mapGroups[this.mapGroupsByUnit[n][g]].rasterMapGroup.rastermapgroup("getRasterMaps");for(d=0;d<b.length;d++){b[d].rastermap("updateTimeSeriesLayerMinMax",f[0],f[1],e,l)}}}break}}};this.rearangeMapsInMapGroup=function(){var b;for(b=0;b<this.mapGroups.length;b++){this.mapGroups[b].rasterMapGroup.rastermapgroup("rearangeMapsInMapGroup")}};this.updateTime=function(){var b;for(b=0;b<this.mapGroups.length;b++){this.mapGroups[b].rasterMapGroup.rastermapgroup("updateTime")}};this.unsyncMapGroups=function(){var b;mapSync=false;a("#syncMapGroupsByUnit").removeClass("isSynced");a(".syncedInfo").remove();a(".map-group-sidebar").children().not("[name='checkbox-mode-change']").show();for(b=0;b<this.mapGroups.length;b++){this.mapGroups[b].rasterMapGroup.rastermapgroup("loadStatsForMapsInMapGroup");this.mapGroups[b].rasterMapGroup.rastermapgroup("updateColorRamp");this.mapGroups[b].rasterMapGroup.rastermapgroup("updateMinMax")}};this.syncMapGroupsByUnit=function(){var g,n,e,l,f,d=[],o=[],h,k,b=[],j;this.mapGroupsByUnit={};mapSync=true;if(this.mapGroups.length>0){for(g=0;g<this.mapGroups.length;g++){l=this.mapGroups[g].rasterMapGroup.rastermapgroup("option","unit");if(l!=""){if(!this.mapGroupsByUnit.hasOwnProperty(l)){this.mapGroupsByUnit[l]=[]}this.mapGroupsByUnit[l].push(g)}}}for(n in this.mapGroupsByUnit){if(!this.mapGroupsByUnit.hasOwnProperty(n)){continue}if(this.mapGroupsByUnit[n].length>1){for(g=0;g<this.mapGroupsByUnit[n].length;g++){if(g>0){j=this.mapGroups[this.mapGroupsByUnit[n][g]].rasterMapGroup.rastermapgroup("getMapGroupSideBar");j.children().hide();j.append('<p class="syncedInfo" style="font-size: 10pt;">This map view is synchronized - use legend of '+this.mapGroups[this.mapGroupsByUnit[n][0]].rasterMapGroup.rastermapgroup("option","outputName")+" ["+n+"]</p>")}f=this.mapGroups[this.mapGroupsByUnit[n][g]].rasterMapGroup.rastermapgroup("getMinMax");d.push(f[0]);o.push(f[1])}f[0]=Math.min.apply(Math,d);f[1]=Math.max.apply(Math,o);k=this.mapGroups[this.mapGroupsByUnit[n][0]].rasterMapGroup.rastermapgroup("getMapGroupLegend");h=k.mapLegend("getWebGlColorRamp");this.mapGroups[this.mapGroupsByUnit[n][0]].rasterMapGroup.rastermapgroup("setMinMax",f[0],f[1]);for(g=0;g<this.mapGroupsByUnit[n].length;g++){b=this.mapGroups[this.mapGroupsByUnit[n][g]].rasterMapGroup.rastermapgroup("getRasterMaps");for(e=0;e<b.length;e++){b[e].rastermap("updateTimeSeriesLayerMinMax",f[0],f[1],f[0],f[1]);b[e].rastermap("updateTimeSeriesLayerColorRamp",h)}}}}};this.checkMapSync=function(){var d,f,b=[],e=false;if(this.mapGroups.length>0){for(d=0;d<this.mapGroups.length;d++){f=this.mapGroups[d].rasterMapGroup.rastermapgroup("option","unit");if(f!=""){if(a.inArray(f,b)>-1){a("#syncMapGroupsByUnit").addClass("syncAble");e=true;break}else{b.push(f)}}}if(!e){a("#syncMapGroupsByUnit").removeClass("syncAble");e=false}}else{a("#syncMapGroupsByUnit").removeClass("syncAble");e=false}};if(this.init){return new a.landisMaps()}else{this.set();return this}}})(jQuery);(function(a){a.landisCharts=function(){this.set=function(){this.init=true;this.charts=[];return this};this.checkChartCandidates=function(e){var d,b,f=[];for(c in this.charts){b=-1;for(cc in e){if(e[cc].extension==this.charts[c].extension&&e[cc].output==this.charts[c].output&&e[cc].field==this.charts[c].field){b=cc;break}}if(b===-1){f.push(c)}}f.sort();f.reverse();for(chart in f){this.charts[f[chart]].chartVis.chart("destroy");this.charts.splice(f[chart],1)}for(c in e){b=-1;for(d=0;d<this.charts.length;d++){if(e[c].extension==this.charts[d].extension&&e[c].output==this.charts[d].output&&e[c].field==this.charts[d].field){b=d;break}}if(b>-1){this.charts[b].chartVis.chart("updateChartData",e[c].scenarios)}else{this.charts.push(e[c]);this.charts[this.charts.length-1].chartVis=a("<div>").chart({chartId:this.charts[this.charts.length-1].extension+"-"+this.charts[this.charts.length-1].output+"-"+this.charts[this.charts.length-1].field,extensionName:landisMetadata.getExtensionAttributeById(this.charts[this.charts.length-1].extension,"extensionName"),outputName:landisMetadata.getOutputAttributeById(this.charts[this.charts.length-1].extension,this.charts[this.charts.length-1].output,"outputName"),fieldName:landisMetadata.getFieldAttributeById(this.charts[this.charts.length-1].extension,this.charts[this.charts.length-1].output,this.charts[this.charts.length-1].field,"name"),fieldDescription:landisMetadata.getFieldAttributeById(this.charts[this.charts.length-1].extension,this.charts[this.charts.length-1].output,this.charts[this.charts.length-1].field,"description"),extensionId:landisMetadata.getExtensionAttributeById(this.charts[this.charts.length-1].extension,"extensionId"),outputId:landisMetadata.getOutputAttributeById(this.charts[this.charts.length-1].extension,this.charts[this.charts.length-1].output,"outputId"),unit:landisMetadata.getFieldAttributeById(this.charts[this.charts.length-1].extension,this.charts[this.charts.length-1].output,this.charts[this.charts.length-1].field,"unit"),scenarios:this.charts[this.charts.length-1].scenarios,minX:a("#TimeControl").timeControl("option","timeMin"),maxX:a("#TimeControl").timeControl("option","timeMax"),hiddenUIContainer:"#HiddenUIContainer"}).appendTo("#ChartContainer");arrangeApplicationData();this.charts[this.charts.length-1].chartVis.chart("loadData")}}arrangeApplicationData()};this.addChartGroup=function(b){};this.updateTime=function(){var b;for(b=0;b<this.charts.length;b++){this.charts[b].chartVis.chart("updateTime")}};this.addChart=function(b){};if(this.init){return new a.landisCharts()}else{this.set();return this}}})(jQuery);(function(d,b,a,e){d.widget("landis.timeControl",{options:{timeMin:0,timeMax:100,timeInterval:1,currentTime:0,snapToInterval:false,playbackSpeed:1,hiddenUIContainer:"body"},_create:function(){this.element.addClass("time-bookmark");this._setupUserInerfaceAndEvents();this._setOptions({timeMin:this.options.timeMin,timeMax:this.options.timeMax,timeInterval:this.options.timeInterval,currentTime:this.options.currentTime,snapToInterval:this.options.snapToInterval,playbackSpeed:this.options.playbackSpeed,hiddenUIContainer:this.options.hiddenUIContainer})},_destroy:function(){this.element.removeClass("time-bookmark");this.element.empty();this._super()},_setOption:function(h,k){var g=this,j=this.options[h],f={timeMin:function(){g._drawTimeTickAndLabel("min",g.options.timeMin);g._timeSlider.slider("option","min",g.options.timeMin);g._drawTimeTickAndLabel("current",g.options.currentTime)},timeMax:function(){g._drawTimeTickAndLabel("max",g.options.timeMax);g._timeSlider.slider("option","max",g.options.timeMax);g._drawTimeTickAndLabel("current",g.options.currentTime)},currentTime:function(){d.pubsub("publish",T_CURRENTTIME,g.options.currentTime);g._timeSlider.slider("option","value",g.options.currentTime);g._drawTimeTickAndLabel("current",g.options.currentTime)},timeInterval:function(){g._timeSlider.slider("option","step",(function(){if(g.options.snapToInterval){var l=Math.floor(g.options.currentTime/g.options.timeInterval)*g.options.timeInterval;if(l!=g.options.currentTime){g._setOption("currentTime",l)}return g.options.timeInterval}else{return 1}})())},snapToInterval:function(){g._timeSlider.slider("option","step",(function(){if(g.options.snapToInterval){var l=Math.floor(g.options.currentTime/g.options.timeInterval)*g.options.timeInterval;if(l!=g.options.currentTime){g._setOption("currentTime",l)}return g.options.timeInterval}else{return 1}})())},playbackSpeed:function(){g._playbackSpeedLabel.text("playback speed: "+g.options.playbackSpeed.toFixed(2)+"x")}};switch(h){case"currentTime":if(k>g.options.timeMax){k=g.options.timeMax;if(g._playbackTimer.isActive){g._playbackTimer.pause();g._playbackButton.removeClass("playing")}}else{if(k<g.options.timeMin){k=g.options.timeMin}}break;case"timeMin":if(k>g.options.currentTime){g._setOption("currentTime",k)}break;case"timeMax":if(k<g.options.currentTime){g._setOption("currentTime",k)}break;case"timeInterval":if(k<1){k=1}break;case"playbackSpeed":if(k>4){k=4}else{if(k<0.25){k=0.25}}break}this._super(h,k);if(h in f){f[h]();this._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUserInerfaceAndEvents:function(){var f=this;f._container=d("<div>").addClass("time-bookmark-container").appendTo(f.element);f._playbackButton=d("<button>").addClass("playback-button").button().on("click",function(g){if(f._playbackTimer.isActive){f._playbackTimer.pause();f._playbackButton.removeClass("playing")}else{f._playbackTimer.play(true);f._playbackButton.addClass("playing")}}).appendTo(f._container);f._timeSlider=d("<div>").addClass("time-slider").slider({range:"min",min:f.options.timeMin,max:f.options.timeMax,value:f.options.currentTime,step:(function(){if(f.options.snapToInterval){return f.options.timeInterval}else{return 1}})(),slide:function(g,h){f._setOptions({currentTime:h.value})},start:function(g,h){if(f._playbackTimer.isActive){f._playbackTimer.pause();f._playbackButton.removeClass("playing")}}}).appendTo(f._container);f._timeBar=d("<div>").addClass("time-bar").appendTo(f._container);f._playbackPreferencesButton=d("<button>").addClass("playback-preferences-button").attr("data-dropdown","#dropdown-playback-preferences-dialog").attr("data-horizontal-offset","4").button().appendTo(f._container);f._playbackPreferencesDialog=d("<div>").attr("id","dropdown-playback-preferences-dialog").addClass("dropdown dropdown-tip dropdown-anchor-right dropdown-playback-preferences-dialog").appendTo(f.options.hiddenUIContainer);f._playbackPreferencesDialogContent=d("<div>").addClass("dropdown-panel").appendTo(f._playbackPreferencesDialog);f._playbackSpeedLabel=d("<div>").text("playback speed: "+f.options.playbackSpeed.toFixed(2)+"x").appendTo(f._playbackPreferencesDialogContent);f._playbackSpeedSlider=d("<div>").addClass("playback-speed-slider").slider({min:-20,max:20,value:(10*Math.log(f.options.playbackSpeed)/Math.log(2)),slide:function(h,j){var g=parseFloat(Math.pow(2,(j.value/10)).toFixed(2));f._setOption("playbackSpeed",g);f._playbackSpeedLabel.text("playback speed: "+f.options.playbackSpeed.toFixed(2)+"x");f._playbackTimer.set({time:parseInt(1000/g)})}}).appendTo(f._playbackPreferencesDialogContent);f._playbackSpeedLegend=d("<div>").addClass("playback-speed-legend").append('<span class="left">slower</span><span class="center">normal</span><span class="right">faster</span>').appendTo(f._playbackPreferencesDialogContent);f._playbackSpeedLegend.find("span.center").on("click",function(g){f._setOption("playbackSpeed",1);f._playbackSpeedSlider.slider("option","value",0);f._playbackSpeedLabel.text("playback speed: "+f.options.playbackSpeed.toFixed(2)+"x");f._playbackTimer.set({time:1000})});d("<div>").addClass("dropdown-divider").appendTo(f._playbackPreferencesDialogContent);f._snapToInterval=d("<input>").attr("type","checkbox").attr("name","checkbox-snap-to-interval").attr("id","checkbox-snap-to-interval").prop("checked",f.options.snapToInterval).addClass("css-checkbox").on("change",function(g){f._setOption("snapToInterval",d(this).is(":checked"))}).appendTo(f._playbackPreferencesDialogContent);d("<label>").attr("for","checkbox-snap-to-interval").text("snap to greatest common interval").addClass("css-label").appendTo(f._playbackPreferencesDialogContent);f._setupPlaybackTimer()},_drawTimeTickAndLabel:function(g,h){var f=this,j=parseInt((f._timeBar.width()-1)*((h-f.options.timeMin)/(f.options.timeMax-f.options.timeMin)));f._container.find(".time-bar .tick-"+g).remove();d('<div class="tick-'+g+' tick-top"></div>').css("left",j+"px").appendTo(f._timeBar);d('<div class="tick-'+g+' tick-label"></div>').css("left",j+"px").text(h).appendTo(f._timeBar)},_setupPlaybackTimer:function(){var f=this;f._playbackTimer=d.timer(function(){f._setOption("currentTime",f.options.currentTime+f._timeSlider.slider("option","step"))},parseInt(1000/f.options.playbackSpeed),false)},stopPlayback:function(){var f=this;if(f._playbackTimer.isActive){f._playbackTimer.pause();f._playbackButton.removeClass("playing")}},isPlaying:function(){var f=this;if(f._playbackTimer.isActive){return true}else{return false}},_setupEvents:function(){var f=this;return},_playbackPreferencesDialogTemplate:"<span>Playback Speed: </span><br />             "})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.scenarioSelector",{options:{scenarios:{},scenarioMax:4,scenarioMin:1,selectedScenarioIds:[1],hiddenUIContainer:"body"},_create:function(){var f=this;f.element.addClass("scenario-selector");f._setupUI();f._setupEvents();f._setOptions({scenarios:this.options.scenarios,scenairoMin:this.options.scenarioMin,scenairoMax:this.options.scenarioMax,hiddenUIContainer:this.options.hiddenUIContainer});d.pubsub("publish",T_CHANGESCENARIOS,"selectedScenarioIds")},_destroy:function(){var f=this;f.element.removeClass("scenario-selector");f.element.empty();f._super()},_setOption:function(h,k){var g=this,j=this.options[h],f={scenarioMax:function(){g._updateUI()}};this._super(h,k);if(h in f){f[h]();this._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUI:function(){var f=this,h,g;f._container=d("<div>").addClass("scenario-selector-container").appendTo(f.element);f._scenarioSelector=d("<div>").addClass("scenario-selector-button").attr("data-dropdown","#dropdown-scenario-selector").attr("data-horizontal-offset","0").append("<span>Scenarios</span>").appendTo(f._container);f._scenarioSelectorDropdown=d("<div>").attr("id","dropdown-scenario-selector").addClass("dropdown dropdown-tip dropdown-scenario-selector").appendTo(f.options.hiddenUIContainer);f._scenarioSelectorDropdownContent=d("<div>").addClass("dropdown-panel").append("<span>select scenarios:<span><br/><br/>").appendTo(f._scenarioSelectorDropdown);for(scenario in f.options.scenarios){h=d.inArray(f.options.scenarios[scenario].id,f.options.selectedScenarioIds)>-1?true:false;g=h&&f.options.selectedScenarioIds.length<=f.options.scenarioMin?true:false;d("<input>").attr("type","checkbox").attr("id","s-"+f.options.scenarios[scenario].id).attr("name","scenario-checkbox").val(f.options.scenarios[scenario].id).prop("checked",h).prop("disabled",g).addClass("css-checkbox").appendTo(f._scenarioSelectorDropdownContent);d("<label>").attr("for","s-"+f.options.scenarios[scenario].id).text(f.options.scenarios[scenario].name).addClass("css-label").appendTo(f._scenarioSelectorDropdownContent)}},_updateUI:function(){var g=this,h=d('input[name="scenario-checkbox"]:checkbox:checked'),f=d('input[name="scenario-checkbox"]:checkbox:not(:checked)');if(g.options.scenarioMax==1){h.prop("disabled",false)}else{if(h.length>=g.options.scenarioMax){f.prop("disabled",true)}else{f.prop("disabled",false)}}},_setupEvents:function(){var f=this;f._scenarioSelectorDropdown.on("show",function(h,g){d.pubsub("publish",T_STOPPLAYBACK,"scenario-selector")}).on("hide",function(h,g){d.pubsub("publish",T_CHANGESCENARIOS,"selectedScenarioIds")});d('input[name="scenario-checkbox"]:checkbox').change(function(k){var h,j=d('input[name="scenario-checkbox"]:checkbox:checked'),g=d('input[name="scenario-checkbox"]:checkbox:not(:checked)');if(f.options.scenarioMax==1){j.prop("disabled",false);j.prop("checked",false);f.options.selectedScenarioIds.splice(0,f.options.selectedScenarioIds.length);d(this).prop("checked","true");f.options.selectedScenarioIds.push(parseInt(d(this).val()))}else{if(j.length<=f.options.scenarioMin){j.prop("disabled",true)}else{j.prop("disabled",false)}if(j.length>=f.options.scenarioMax){g.prop("disabled",true)}else{g.prop("disabled",false)}h=d.inArray(parseInt(d(this).val()),f.options.selectedScenarioIds);if(h>-1){f.options.selectedScenarioIds.splice(h,1)}else{f.options.selectedScenarioIds.push(parseInt(d(this).val()))}}})}})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.mapSelector",{options:{mapoutputs:{},selectedMapId:0,selectedParameterIds:[],parameterLimit:4,hiddenUIContainer:"body"},_create:function(){var f=this;f.element.addClass("map-control");f._setupUserInerfaceAndEvents();f._setOptions({mapoutputs:this.options.mapoutputs,selectedMapId:this.options.selectedMapId,selectedParameterIds:this.options.selectedParameterIds,parameterLimit:this.options.parameterLimit,hiddenUIContainer:this.options.hiddenUIContainer})},_destroy:function(){this.element.removeClass("map-control");this.element.empty();this._super()},_setOption:function(h,k){var g=this,j=this.options[h],f={parameterLimit:function(){g._updateUI()}};this._super(h,k);if(h in f){f[h]();this._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUserInerfaceAndEvents:function(){var g=this,f,h;g._container=d("<div>").addClass("map-control-container").appendTo(g.element);g._mapControl=d("<div>").addClass("map-control map-control-button").attr("data-dropdown","#dropdown-map-control").attr("data-horizontal-offset","0").append("<span>Maps</span>").appendTo(g._container);g._mapControlDropdown=d("<div>").attr("id","dropdown-map-control").addClass("dropdown dropdown-tip dropdown-map-control").appendTo(g.options.hiddenUIContainer);g._mapControlDropdown.on("show",function(k,j){d.pubsub("publish",T_STOPPLAYBACK,"map-control")}).on("hide",function(k,j){d.pubsub("publish",T_CHANGEMAPS,"hide-map-control")});g._mapControlDropdownContent=d("<div>").addClass("dropdown-panel").css("overflow","auto").appendTo(g._mapControlDropdown);g._mapControlOutputList=d("<div>").addClass("output-list").text(d.isEmptyObject(g.options.mapoutputs)?"no maps available":"").appendTo(g._mapControlDropdownContent);d("<div>").css("clear","both").appendTo(g._mapControlDropdownContent);for(extension in g.options.mapoutputs){f=d("<div>").addClass("extension-container").appendTo(g._mapControlOutputList);d("<p>").attr("id","et-"+g.options.mapoutputs[extension].extensionId).addClass("extension-topic").text(g.options.mapoutputs[extension].extensionName).appendTo(f);h=d("<div>").addClass("extension-outputs").appendTo(f);for(output in g.options.mapoutputs[extension].outputs){d("<input>").attr("type","checkbox").attr("id","mc-"+g.options.mapoutputs[extension].extensionId+"-"+g.options.mapoutputs[extension].outputs[output].outputId).attr("name","map-control-checkbox").val(g.options.mapoutputs[extension].extensionId+"-"+g.options.mapoutputs[extension].outputs[output].outputId).addClass("css-checkbox").appendTo(h);d("<label>").attr("for","mc-"+g.options.mapoutputs[extension].extensionId+"-"+g.options.mapoutputs[extension].outputs[output].outputId).text(g.options.mapoutputs[extension].outputs[output].outputName).addClass("css-label").appendTo(h)}}d('input[name="map-control-checkbox"]:checkbox').change(function(p){var o=d(this).val().split("-").map(function(q){return parseInt(q,10)}),n=d('input[name="map-control-checkbox"]:checkbox:checked'),l=d('input[name="map-control-checkbox"]:checkbox:not(:checked)'),j,k;if(g.options.parameterLimit==1){n.prop("checked",false);g.options.selectedParameterIds.splice(0,g.options.selectedParameterIds.length);d(this).prop("checked","true");g.options.selectedParameterIds.push(o)}else{if(n.length>=g.options.parameterLimit){l.prop("disabled",true)}else{l.prop("disabled",false)}j=-1;for(k=0,len=g.options.selectedParameterIds.length;k<len;k++){if(g.options.selectedParameterIds[k][0]===o[0]&&g.options.selectedParameterIds[k][1]===o[1]){j=k;break}}if(j>-1){g.options.selectedParameterIds.splice(j,1)}else{g.options.selectedParameterIds.push(o)}}})},_updateUI:function(){var f=this,h=d('input[name="map-control-checkbox"]:checkbox:checked'),g=d('input[name="map-control-checkbox"]:checkbox:not(:checked)');if(f.options.parameterLimit==1){}else{if(h.length>=f.options.parameterLimit){g.prop("disabled",true)}else{g.prop("disabled",false)}}},_setupEvents:function(){return}})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.chartSelector",{options:{chartoutputs:{},selectedParameterIds:[],parameterLimit:4,hiddenUIContainer:"body"},_create:function(){this.element.addClass("chart-control");this._setupUserInerfaceAndEvents();this._setOptions({chartoutputs:this.options.chartoutputs,parameterLimit:this.options.parameterLimit,hiddenUIContainer:this.options.hiddenUIContainer})},_destroy:function(){this.element.removeClass("chart-control");this.element.empty();this._super()},_setOption:function(h,k){var g=this,j=this.options[h],f={parameterLimit:function(){g._updateUI()}};this._super(h,k);if(h in f){f[h]();this._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUserInerfaceAndEvents:function(){var g=this;g._container=d("<div>").addClass("chart-control-container").appendTo(g.element);g._chartControl=d("<div>").addClass("chart-control chart-control-button").attr("data-dropdown","#dropdown-chart-control").attr("data-horizontal-offset","0").append("<span>Charts</span>").appendTo(g._container);g._chartControlDropdown=d("<div>").attr("id","dropdown-chart-control").addClass("dropdown dropdown-tip dropdown-chart-control").appendTo(g.options.hiddenUIContainer);g._chartControlDropdown.on("show",function(k,j){d.pubsub("publish",T_STOPPLAYBACK,"chart-control")}).on("hide",function(k,j){d.pubsub("publish",T_CHANGECHARTS,"hide-chart-control")});g._chartControlDropdownContent=d("<div>").addClass("dropdown-panel").css("overflow","auto").appendTo(g._chartControlDropdown);g._chartControlOutputList=d("<div>").addClass("output-list").text(d.isEmptyObject(g.options.chartoutputs)?"no charts available":"").appendTo(g._chartControlDropdownContent);d("<div>").css("clear","both").appendTo(g._chartControlDropdownContent);for(extension in g.options.chartoutputs){var f=d("<div>").addClass("extension-container").appendTo(g._chartControlOutputList);d("<p>").attr("id","et-"+g.options.chartoutputs[extension].extensionId).addClass("extension-topic").text(g.options.chartoutputs[extension].extensionName).appendTo(f);var h=d("<div>").addClass("extension-outputs").appendTo(f);for(output in g.options.chartoutputs[extension].outputs){for(field in g.options.chartoutputs[extension].outputs[output].fields){d("<input>").attr("type","checkbox").attr("id","cc-"+g.options.chartoutputs[extension].extensionId+"-"+g.options.chartoutputs[extension].outputs[output].outputId+"-"+field).attr("name","chart-control-checkbox").val(g.options.chartoutputs[extension].extensionId+"-"+g.options.chartoutputs[extension].outputs[output].outputId+"-"+field).addClass("css-checkbox").appendTo(h);d("<label>").attr("for","cc-"+g.options.chartoutputs[extension].extensionId+"-"+g.options.chartoutputs[extension].outputs[output].outputId+"-"+field).text(g.options.chartoutputs[extension].outputs[output].fields[field].name).addClass("css-label").appendTo(h)}}}d('input[name="chart-control-checkbox"]:checkbox').change(function(q){var o=d(this).val().split("-").map(function(r){return parseInt(r,10)});var p=d('input[name="chart-control-checkbox"]:checkbox:checked');var n=d('input[name="chart-control-checkbox"]:checkbox:not(:checked)');if(g.options.parameterLimit==1){p.prop("checked",false);g.options.selectedParameterIds.splice(0,g.options.selectedParameterIds.length);d(this).prop("checked","true");g.options.selectedParameterIds.push(extOut)}else{if(p.length>=g.options.parameterLimit){n.prop("disabled",true)}else{n.prop("disabled",false)}var k=-1;for(var l=0,j=g.options.selectedParameterIds.length;l<j;l++){if(g.options.selectedParameterIds[l][0]===o[0]&&g.options.selectedParameterIds[l][1]===o[1]&&g.options.selectedParameterIds[l][2]===o[2]){k=l;break}}if(k>-1){g.options.selectedParameterIds.splice(k,1)}else{g.options.selectedParameterIds.push(o)}}})},_updateText:function(f,g){d(f).html(g)},_updateUI:function(){var f=this;var h=d('input[name="chart-control-checkbox"]:checkbox:checked');var g=d('input[name="chart-control-checkbox"]:checkbox:not(:checked)');if(f.options.parameterLimit==1){}else{if(h.length>=f.options.parameterLimit){g.prop("disabled",true)}else{g.prop("disabled",false)}}},_setupEvents:function(){var f=this}})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.rastermapgroup",{options:{scenarios:[],unit:"",extensionId:"",extensionName:"",outputId:"",outputName:"",timeInterval:1,dataType:"continuous",hiddenUIContainer:"body"},_create:function(){this.rasterMaps=[];this.legendMinMax=[];this.element.addClass("map-group");this._setupUserInerfaceAndEvents();switch(landisSettings.settings.map.basemap.source){case"plain":this._baseLayer=new ol.layer.Tile({source:new ol.source.XYZ({url:location.href.substring(0,location.href.lastIndexOf("/"))+"/img/black.png"})});break;case"osm":this._baseLayer=new ol.layer.Tile({source:new ol.source.OSM()});break;case"toner":this._baseLayer=new ol.layer.Tile({source:new ol.source.Stamen({layer:"toner"})});break;case"terrain":case"stamen":default:this._baseLayer=new ol.layer.Tile({source:new ol.source.Stamen({layer:"terrain"})})}this._baseLayer.setSaturation(landisSettings.settings.map.basemap.saturation);this._baseLayer.setBrightness(landisSettings.settings.map.basemap.brightness);this._baseLayer.setContrast(landisSettings.settings.map.basemap.contrast);this._setOptions({scenarios:this.options.scenarios,unit:this.options.unit,extensionId:this.options.extensionId,extensionName:this.options.extensionName,outputId:this.options.outputId,outputName:this.options.outputName,timeInterval:this.options.timeInterval,dataType:this.options.dataType,baseLayer:this.options.baseLayer,hiddenUIContainer:this.options.hiddenUIContainer})},_destroy:function(){this.element.removeClass("map-group");this.element.remove();this._super()},_setOption:function(h,k){var g=this,j=this.options[h],f={scenarioMax:function(){g._updateUI()}};switch(h){case"mainScenarioId":k=parseInt(k);break;case"compareScenarioId":k=parseInt(k);break;case"timeMax":if(k<=g.options.currentTime){k=g.options.currentTime}break}this._super(h,k);if(h in f){f[h]();this._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUserInerfaceAndEvents:function(){var f=this,g="one";f._olMapObjects=[];if(f.options.scenarios.length>1){g="two"}f._mapGroup=d("<div>").addClass("map-group-container").addClass(g).appendTo(f.element);f._mapGroupHeader=d("<div>").addClass("map-group-header").text(f.options.extensionName+": "+f.options.outputName+" ["+f.options.unit+"]").appendTo(f._mapGroup);f._mapGroupContent=d("<div>").addClass("map-group-content").appendTo(f._mapGroup);f._mapGroupMaps=d("<div>").addClass("map-group-maps").appendTo(f._mapGroupContent);for(s in f.options.scenarios){f._createRasterMap(s)}f._mapGroupSideBar=d("<div>").addClass("map-group-sidebar").appendTo(f._mapGroupContent);if(f.options.dataType!="nominal"){f._maxValue=d("<div>").html('max: <span class="legMax" style="color: #6699CC">legMax</span> (<span class="visMax" style="color: #6699CC">visMax</span>)').css({"font-size":"10pt","margin-bottom":"8px"}).appendTo(f._mapGroupSideBar)}f._mapGroupLegend=d("<div>").attr("id","mgcs-"+f.getMapGroupId()).appendTo(f._mapGroupSideBar);if(f.options.dataType!="nominal"){f._minValue=d("<div>").html('min: <span class="legMin" style="color: #6699CC">legMin</span> (<span class="visMin" style="color: #6699CC">visMin</span>)<br /> (<span style="color: #6699CC">visible range</span>)').css({"font-size":"10pt","margin-top":"8px"}).appendTo(f._mapGroupSideBar)}f._allowModeChange=false;if(f.options.dataType!="nominal"){f._allowModeChange=true}if(f._allowModeChange){d("<br>").appendTo(f._mapGroupSideBar);f._modeChange=d("<input>").attr("type","checkbox").attr("name","checkbox-mode-change").attr("id","checkbox-mode-change-"+f.getMapGroupId()).prop("checked",false).addClass("css-checkbox").on("change",function(h){f._mapGroupLegend.mapLegend("option","categorical",d(this).is(":checked"))}).appendTo(f._mapGroupSideBar);d("<label>").attr("for","checkbox-mode-change-"+f.getMapGroupId()).text("categorical").addClass("css-label").appendTo(f._mapGroupSideBar)}},drawMapLegend:function(){var f=this;f._mapGroupLegend.mapLegend({min:f.legendMinMax[0],max:f.legendMinMax[1],filterMin:f.legendMinMax[0],filterMax:f.legendMinMax[1],handles:f.generateHandles(),dataType:f.options.dataType,mapGroupId:f.getMapGroupId(),handleLimit:9,categorical:false})},getMapGroupId:function(){var f=this;return f.options.extensionId+"-"+f.options.outputId},updateColorRamp:function(){var g=this,f=g._mapGroupLegend.mapLegend("getWebGlColorRamp"),h;for(h=0;h<g.rasterMaps.length;h++){g.rasterMaps[h].rastermap("updateTimeSeriesLayerColorRamp",f)}},generateHandles:function(){var u=this,p,o,q=[],r,l=(u.options.dataType==="nominal")?(landisSettings.settings.map.legend.qualCol):((u.stats.classification.colorSchema==="diverging")?(landisSettings.settings.map.legend.divCol):(landisSettings.settings.map.legend.seqCol)),g=u.stats.classification.classes.length,n=(u.stats.classification.colorSchema==="sequential")?(9):((u.stats.classification.colorSchema==="diverging")?(11):(12)),t,f,k;if(g>n){t=n;f=g-n}else{t=g}r=colorbrewer[u.stats.classification.colorSchema][l][t];for(o=0;o<f;o++){if(d.inArray(k=getRandomColor(),r)===-1){r.push(k)}else{o--}}for(p=0;p<u.stats.classification.classes.length;p++){q.push({value:u.stats.classification.classes[p],color:r[p]})}return q},_setupEvents:function(){return},_createRasterMap:function(j){var g=this,h=g.options.extensionId+"-"+g.options.outputId+"-"+g.options.scenarios[j],f=d("<div>").addClass("raster-map").attr("id",h).appendTo(g._mapGroupMaps);f.rastermap({dataPath:g.options.scenarios[j]+"/"+g.options.extensionId+"/"+g.options.outputId,mapId:h,scenarioId:g.options.scenarios[j],timeInterval:g.options.timeInterval});g.rasterMaps.push(f)},getRasterMapsCountInGroup:function(){var f=this;return f.rasterMaps.length},getRasterMaps:function(){var f=this;return f.rasterMaps},setupMinMax:function(){var g=this,k=g.legendMinMax[0],f=g.legendMinMax[1],l=g.legendMinMax[0],j=g.legendMinMax[1],h;if(g.options.dataType!="nominal"){g._writeMinMaxToLegend(j,l,f,k)}for(h=0;h<g.rasterMaps.length;h++){g.rasterMaps[h].rastermap("updateTimeSeriesLayerMinMax",k,f,l,j)}},updateMinMax:function(){var g=this,k=g.legendMinMax[0],f=g.legendMinMax[1],l=g.legendMinMax[0],j=g.legendMinMax[1],h;g._mapGroupLegend.mapLegend("option","min",k);g._mapGroupLegend.mapLegend("option","max",f);l=g._mapGroupLegend.mapLegend("option","filterMin");j=g._mapGroupLegend.mapLegend("option","filterMax");if(g.options.dataType!="nominal"){g._writeMinMaxToLegend(j,l,f,k)}for(h=0;h<g.rasterMaps.length;h++){g.rasterMaps[h].rastermap("updateTimeSeriesLayerMinMax",k,f,l,j)}},filterMinMax:function(){var g=this,k=g.legendMinMax[0],f=g.legendMinMax[1],l=g.legendMinMax[0],j=g.legendMinMax[1],h;l=g._mapGroupLegend.mapLegend("option","filterMin");j=g._mapGroupLegend.mapLegend("option","filterMax");if(g.options.dataType!="nominal"){g._writeMinMaxToLegend(j,l,f,k)}for(h=0;h<g.rasterMaps.length;h++){g.rasterMaps[h].rastermap("updateTimeSeriesLayerMinMax",k,f,l,j)}},_writeMinMaxToLegend:function(j,k,g,h){var f=this;f._maxValue.find(".visMax").html(j);f._minValue.find(".visMin").html(k);f._maxValue.find(".legMax").html(g);f._minValue.find(".legMin").html(h)},setGdalDataType:function(){var f=this,g;for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].rastermap("setGdalDataType",f.gdalDataType)}},getFirstMap:function(){var f=this;if(f._olMapObjects.length>0){return f._olMapObjects[0]}else{return false}},getAllMapObjects:function(){var f=this;if(f._olMapObjects.length>0){return f._olMapObjects}else{return false}},getMapGroupLegend:function(){var f=this;return f._mapGroupLegend},getMapGroupSideBar:function(){var f=this;return f._mapGroupSideBar},getMapGroupMaps:function(){var f=this;return f._mapGroupMaps},drawRasterMaps:function(){var f=this,h,g;for(g=0;g<f.rasterMaps.length;g++){h=f.rasterMaps[g].rastermap("drawMap",f._baseLayer);f._olMapObjects.push(h)}f.rearangeMapsInMapGroup()},drawLastAddedRasterMap:function(){var f=this,g=f.rasterMaps[f.rasterMaps.length-1].rastermap("drawMap",f._baseLayer);f._olMapObjects.push(g)},bindRasterMapViews:function(g){var f=this;mo;for(mo=0;mo<f._olMapObjects.length;mo++){if(mo>0){f.rasterMaps[mo].rastermap("bindView",g)}}},updateTime:function(){var f=this,g;for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].rastermap("updateDataLayer")}},updateSizeOfMaps:function(){var f=this,g;for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].rastermap("updateSize")}},rearangeMapsInMapGroup:function(){var f=this,h=f._mapGroupMaps.outerHeight()/f._mapGroupMaps.outerWidth(),g;switch(f.rasterMaps.length){case 1:f.rasterMaps[0].outerHeight(f._mapGroupMaps.outerHeight());f.rasterMaps[0].outerWidth(f._mapGroupMaps.outerWidth());break;case 2:if(h<1.2){for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].outerHeight(f._mapGroupMaps.outerHeight());f.rasterMaps[g].outerWidth(f._mapGroupMaps.outerWidth()*0.5)}}else{for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].outerHeight(f._mapGroupMaps.outerHeight()*0.5);f.rasterMaps[g].outerWidth(f._mapGroupMaps.outerWidth())}}break;case 3:case 4:if(h>1){for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].outerHeight(f._mapGroupMaps.outerHeight()*0.5);f.rasterMaps[g].outerWidth(f._mapGroupMaps.outerWidth()*0.5)}}else{for(g=0;g<f.rasterMaps.length;g++){f.rasterMaps[g].outerHeight(f._mapGroupMaps.outerHeight()*0.5);f.rasterMaps[g].outerWidth(f._mapGroupMaps.outerWidth()*0.5)}}break}},setMinMax:function(h,f){var g=this;g.legendMinMax[0]=h;g.legendMinMax[1]=f;g.updateMinMax()},getMinMax:function(){var f=this;return f.legendMinMax},loadStatsForMapsInMapGroup:function(){var f=this,o=[],h=[],n=[],l,k,g,j;f.legendMinMax=[];for(l=0;l<f.rasterMaps.length;l++){k=f.rasterMaps[l].rastermap("option","mapId");g=k.split("-");j=loadJson(landisSettings.settings.landisdata.path+"/"+landisSettings.settings.landisdata.modeldata+"/"+g[2]+"/"+g[0]+"/"+g[1]+"/metadata.stats.json");f.stats=j;o.push(j.classification.legendMin);h.push(j.classification.legendMax);n.push(j.overTime.gdalDataType)}f.gdalDataType=n[0];f.legendMinMax[0]=Math.min.apply(Math,o);f.legendMinMax[1]=Math.max.apply(Math,h);f.setupMinMax();f.setGdalDataType()},updateRasterMaps:function(h){var g=this,j=[],f;for(os in g.options.scenarios){f=-1;for(ns in h){if(h[ns]==g.options.scenarios[os]){f=os;break}}if(f===-1){j.push(os)}}j.sort();j.reverse();for(map in j){g.options.scenarios.splice(j[map],1);g.rasterMaps[j[map]].rastermap("destroy");g.rasterMaps.splice(j[map],1)}for(ns in h){f=-1;for(os in g.options.scenarios){if(h[ns]==g.options.scenarios[os]){f=ns;break}}if(f===-1){g.options.scenarios.push(h[ns]);g._createRasterMap(g.options.scenarios.length-1);g.drawLastAddedRasterMap();g.updateColorRamp()}}g.rearangeMapsInMapGroup()}})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.mapLegend",{options:{min:0,max:100,handles:[],categorical:false,handleoffset:-8,filterMin:0,filterMax:100,mapGroupId:0,dataType:"continuous",hiddenUIContainer:"body",handleLimit:9},_create:function(){var f=this,g;f.privateHandles=[];for(g=0;g<f.options.handles.length;g++){f.privateHandles[g]=f.options.handles[g]}f.element.addClass("map-legend");f._sliderMode=f.options.dataType=="nominal"?false:true;f._setupUserInerfaceAndEvents();f._setOptions({min:this.options.min,max:this.options.max,filterMin:this.options.filterMin,filterMax:this.options.filterMax,handles:this.options.handles,dataType:this.options.dataType,categorical:this.options.categorical,mapGroupId:f.options.mapGroupId,hiddenUIContainer:this.options.hiddenUIContainer,handleoffset:this.options.handleoffset,handleLimit:this.options.handleLimit})},_setOption:function(h,k){var g=this,j=this.options[h],f={min:function(){if(g.options.dataType!="nominal"){g._rangeSlider.slider("option","min",g.options.min);g._rangeSlider.slider("values",0,g.options.min);g._setOption("filterMin",g.options.min);g.updateHandleValues()}},max:function(){if(g.options.dataType!="nominal"){g._rangeSlider.slider("option","max",g.options.max);g._rangeSlider.slider("values",1,g.options.max);g._setOption("filterMax",g.options.max);g.updateHandleValues()}},currentTime:function(){},timeInterval:function(){},filterMin:function(){d.pubsub("publish",T_MINMAX,g.options.mapGroupId)},filterMax:function(){d.pubsub("publish",T_MINMAX,g.options.mapGroupId)},categorical:function(){if(g.options.dataType!="nominal"){g._drawColorRamp();g._webGLRamp=g.get8BitColors100();d.pubsub("publish",T_COLORRAMP,g.options.mapGroupId)}}};switch(h){case"currentTime":if(k>g.options.timeMax){k=g.options.timeMax;if(g._playbackTimer.isActive){g._playbackTimer.pause();g._playbackButton.removeClass("playing")}}else{if(k<g.options.timeMin){k=g.options.timeMin}}break;case"timeMin":if(k>=g.options.currentTime){k=g.options.currentTime}break;case"timeMax":if(k<=g.options.currentTime){k=g.options.currentTime}break}g._super(h,k);if(h in f){f[h]();g._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_value2percent:function(f){return((f-this.options.min)/(this.options.max-this.options.min))*100},_value2position:function(h){var g=this,f;f=(((h-this.options.min)*(g._colorSlider.innerHeight()))/(this.options.max-this.options.min));return(Math.abs(f-g._colorSlider.innerHeight())+g.options.handleoffset)},_value2positionBottom:function(h){var g=this,f;f=(((h-this.options.min)*(g._colorSlider.innerHeight()))/(this.options.max-this.options.min))},_position2value:function(f){var g=this,h;h=g._colorSlider.innerHeight()-(f-g.options.handleoffset);return Math.round(((h*(this.options.max-this.options.min))/(g._colorSlider.innerHeight()))+this.options.min)},_setupUserInerfaceAndEvents:function(){var f=this,g;if(f._sliderMode){f._colorSliderContainer=d("<div>").addClass("color-slider-container").appendTo(f.element);f._colorSlider=d("<div>").addClass("color-slider").on("dblclick",function(h){if(f.privateHandles.length<f.options.handleLimit){if(d(h.target).hasClass("color-slider")){var j=f._position2value(h.clientY-d(h.target).offset().top+f.options.handleoffset);f.privateHandles.push({value:j,color:f._calculateColorValue(j)});f._addHandle(f.privateHandles.length-1);f._drawColorRamp();f._webGLRamp=f.get8BitColors100();d.pubsub("publish",T_COLORRAMP,f.options.mapGroupId)}}}).appendTo(f._colorSliderContainer);d("<div>").css("clear","both").appendTo(f.element);for(g=0;g<f.privateHandles.length;g++){f._addHandle(g)}f._drawColorRamp();f._webGLRamp=f.get8BitColors100();d.pubsub("publish",T_COLORRAMP,f.options.mapGroupId);f._rangeSlider=d("<div>").insertBefore(d(f._colorSlider)).css({height:"202px","float":"left","margin-right":"10px"});f._rangeSlider.slider({orientation:"vertical",range:true,min:f.options.min,max:f.options.max,values:[f.options.filterMin,f.options.filterMax],slide:function(h,j){f._setOption("filterMin",j.values[0]);f._setOption("filterMax",j.values[1])}})}else{f._classBoxes=d("<div>").addClass("class-boxes").appendTo(f.element);for(g=0;g<f.privateHandles.length;g++){f._addClassBox(g)}f._webGLRamp=f.get8BitColors();d.pubsub("publish",T_COLORRAMP,f.options.mapGroupId)}f._colorPickerDropDown=d("<div>").attr("id","dropdown-farbtastic-"+f.options.mapGroupId).addClass("dropdown dropdown-tip dropdown-anchor-right").appendTo("#HiddenUIContainer");f._colorPickerDropDownContent=d("<div>").addClass("dropdown-panel").appendTo(f._colorPickerDropDown);d("<div>").attr("id","picker-"+f.options.mapGroupId).appendTo(f._colorPickerDropDownContent);d("#dropdown-farbtastic-"+f.options.mapGroupId).on("show",function(n,h){var l=d.farbtastic("#picker-"+f.options.mapGroupId),k=d(h.trigger),j=jQuery.Color(k.css("background-color")).toHexString();l.linkTo(function(){k.css("background-color",this.color);if(f._sliderMode){var o=k.parent().data("color-slider-handle-index");f.privateHandles[o].color=this.color;f._drawColorRamp();f._webGLRamp=f.get8BitColors100();d.pubsub("publish",T_COLORRAMP,f.options.mapGroupId)}else{var o=k.parent().data("class-box-index");f.privateHandles[o].color=this.color;f._webGLRamp=f.get8BitColors();d.pubsub("publish",T_COLORRAMP,f.options.mapGroupId)}});l.setColor(j)}).on("hide",function(j,h){})},updateHandleValues:function(){var f=this;d(f._colorSlider).children(".color-slider-handle-container").each(function(){var g=f._position2value(d(this).position().top),h=d(this).data("color-slider-handle-index");f.privateHandles[h].value=g;f.privateHandles[h].percent=f._value2percent(g);d(this).children(".color-slider-handle-value").text(g)})},_addHandle:function(f){var g=this,h;g.privateHandles[f].percent=g._value2percent(g.privateHandles[f].value);h=d("<div>").addClass("color-slider-handle-container").draggable({axis:"y",zIndex:100,handle:".color-slider-handle",grid:[0,g._colorSlider.innerHeight()/(this.options.max-this.options.min)],containment:d(g._colorSlider).parent().parent(),drag:function(j,l){var k=g._position2value(l.position.top),n=d(this).data("color-slider-handle-index");g.privateHandles[n].value=k;g.privateHandles[n].percent=g._value2percent(k);d(l.helper).children(".color-slider-handle-value").text(k);g._drawColorRamp();g._webGLRamp=g.get8BitColors100();d.pubsub("publish",T_COLORRAMP,g.options.mapGroupId)},stop:function(j,k){}}).offset({top:g._value2position(g.privateHandles[f].value),left:g._colorSlider.width()}).css("position","absolute").data("color-slider-handle-index",f).appendTo(g._colorSlider);d("<div>").addClass("color-slider-handle").on("dblclick",function(k){if(g.privateHandles.length>2){var j=d(k.target).parent().data("color-slider-handle-index");g.privateHandles.splice(j,1);d(k.target).parent().parent().children(".color-slider-handle-container").each(function(){var l=d(this).data("color-slider-handle-index");if(l>j){d(this).data("color-slider-handle-index",l-1)}});d(k.target).parent().remove();g._drawColorRamp();g._webGLRamp=g.get8BitColors100();d.pubsub("publish",T_COLORRAMP,g.options.mapGroupId)}}).appendTo(h);d("<div>").addClass("color-slider-handle-color").attr("data-dropdown","#dropdown-farbtastic-"+g.options.mapGroupId).attr("data-horizontal-offset","8").attr("data-vertical-offset","-5").css("background-color",g.privateHandles[f].color).appendTo(h);d("<div>").addClass("color-slider-handle-value").text(g.privateHandles[f].value).appendTo(h)},_addClassBox:function(f){var g=this,h;h=d("<div>").addClass("class-box-container").data("class-box-index",f).appendTo(g._classBoxes);d("<div>").addClass("class-box").attr("data-dropdown","#dropdown-farbtastic-"+g.options.mapGroupId).attr("data-horizontal-offset","8").attr("data-vertical-offset","-7").css("background-color",g.privateHandles[f].color).appendTo(h);d("<span>").addClass("class-box-label").text(g.privateHandles[f].value).appendTo(h);d("<div>").css("clear","both").appendTo(h)},_calculateColorValue:function(q){var k,h,v,t,o,l,p,n,f,j,u=this.privateHandles.slice();u.sort(function(r,g){return r.value-g.value});if(q<=u[0].value){k=u[0].color}else{if(q>=u[u.length-1].value){k=u[u.length-1].color}else{for(h=0;h<u.length-1;h++){if(q>u[h].value&&q<u[h+1].value){v=h;t=h+1;break}}p=u[v].value;n=u[t].value;c1=jQuery.Color(u[v].color);c2=jQuery.Color(u[t].color);o=Math.abs(q-p);l=Math.abs(n-q);f=((l/(o+l))*c1.red())+((o/(o+l))*c2.red());j=((l/(o+l))*c1.green())+((o/(o+l))*c2.green());l=((l/(o+l))*c1.blue())+((o/(o+l))*c2.blue());return jQuery.Color(f,j,l,null).toHexString()}}return k},_drawColorRamp:function(){var h=this,k=h.privateHandles.slice(),l=0,g="",j,f="0deg";k.sort(function(o,n){return o.percent-n.percent});if(h.options.categorical){l=1}for(j=0;j<k.length-l;j++){if(h.options.categorical){g+=", "+k[j].color+" "+k[j].percent+"%, "+k[j].color+" "+k[j+1].percent+"%"}else{g+=", "+k[j].color+" "+k[j].percent+"%"}}if(h.options.categorical){g+=", "+k[k.length-1].color+" "+k[k.length-1].percent+"%"}g+=")";h._colorSlider.css("background-image","none");h._colorSlider.css("background-image","linear-gradient("+f+g)},getWebGlColorRamp:function(){var f=this;return f._webGLRamp},get8BitColors100:function(){var u=this,f=u.privateHandles.slice(),o=[],q,n,k,g,r,p,t,h;f.sort(function(l,j){return l.percent-j.percent});if(u.options.categorical){f[0].percent=0;q={};q.percent=100;q.color=f[f.length-1].color;f.push(q);for(n=0;n<f.length-1;n++){g=jQuery.Color(f[n].color);for(k=Math.ceil(f[n].percent)+1;k<=Math.floor(f[n+1].percent);k++){o.push(g.red());o.push(g.green());o.push(g.blue());o.push(255)}}}else{if(f[0].percent!=0){q={};q.percent=0;q.color=f[0].color;f.unshift(q)}if(f[f.length-1].percent!=100){q={};q.percent=100;q.color=f[f.length-1].color;f.push(q)}for(n=0;n<f.length-1;n++){r=jQuery.Color(f[n].color);p=jQuery.Color(f[n+1].color);t=Math.floor(f[n+1].percent)-Math.ceil(f[n].percent);for(k=Math.ceil(f[n].percent)+1;k<=Math.floor(f[n+1].percent);k++){h=k-Math.ceil(f[n].percent);o.push(Math.floor(r.red()+h*(p.red()-r.red())/t));o.push(Math.floor(r.green()+h*(p.green()-r.green())/t));o.push(Math.floor(r.blue()+h*(p.blue()-r.blue())/t));o.push(255)}}}return new Uint8Array(o)},get8BitColors:function(){var u=this,f=u.privateHandles.slice(),o=[],q,n,k,g,r,p,t,h;for(n=0;n<f.length-1;n++){g=jQuery.Color(f[n].color);o.push(g.red());o.push(g.green());o.push(g.blue());o.push(255)}return new Uint8Array(o)}})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.chart",{options:{chartId:"",scenarios:[],unit:"",extensionName:"",extensionId:-1,outputName:"",outputId:-1,fieldName:"",fieldDescription:"",minX:0,maxX:100,hiddenUIContainer:"body"},_create:function(){var f=this;this.element.addClass("chart-vis");f._results=[];f._flotData=[];f._flotOptions={crosshairTime:{mode:"x",lineWidth:2,color:"#39F"},xaxis:{min:this.options.minX,max:this.options.maxX},yaxis:{axisLabel:this.options.unit},legend:{position:"nw"},shadowSize:0};this._setupUserInerfaceAndEvents();this._setOptions({chartId:this.options.chartId,scenarios:this.options.scenarios,unit:this.options.unit,extensionName:this.options.extensionName,extensionId:this.options.extensionId,outputName:this.options.outputName,outputId:this.options.outputId,fieldDescription:this.options.fieldDescription,fieldName:this.options.fieldName,minX:this.options.minX,maxX:this.options.maxX,hiddenUIContainer:this.options.hiddenUIContainer})},_destroy:function(){this.element.removeClass("chart-vis");this.element.empty();this._super()},_setOption:function(g,j){var h=this.options[g],f={};this._super(g,j);if(g in f){f[g]();this._triggerOptionChanged(g,h,j)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUserInerfaceAndEvents:function(){var f=this;f._chartVis=d("<div>").addClass("chart-vis-container").appendTo(f.element);f._chartVisHeader=d("<div>").addClass("chart-vis-header").appendTo(f._chartVis);f._chartVisHeaderText=d("<div>").addClass("chart-vis-text").text(this.options.extensionName+": "+this.options.fieldName+" ["+this.options.unit+"]").appendTo(f._chartVisHeader);f._chartVisContent=d("<div>").addClass("chart-vis-content").appendTo(f._chartVis);f._chartVisChart=d("<div>").addClass("chart-vis-chart").attr("id","chart-"+f.options.chartId).appendTo(f._chartVisContent);f._chartVisChart.resize(function(){f.updateTime()});f._chartFilterButton=d("<div>").addClass("filterButton").attr("data-dropdown","#dropdown-chartfilter-"+f.options.extensionId+"-"+f.options.outputId+"-"+f.options.fieldName).attr("data-horizontal-offset","-10").appendTo(f._chartVisHeader);f._chartFilterDropdown=d("<div>").attr("id","dropdown-chartfilter-"+f.options.extensionId+"-"+f.options.outputId+"-"+f.options.fieldName).addClass("dropdown dropdown-tip dropdown-anchor-right dropdown-chartfilters").on("show",function(h,g){}).on("hide",function(h,g){}).appendTo(f.options.hiddenUIContainer);f._chartFilterDropdownContent=d("<div>").addClass("dropdown-panel").append("<span>Filter:<span><br/>").appendTo(f._chartFilterDropdown);f._filterFieldList=d("<select>").addClass("filter-field-list").appendTo(f._chartFilterDropdownContent);f._filterValueList=d("<select>").addClass("filter-value-list").append('<option value="false">none</option>').appendTo(f._chartFilterDropdownContent);f._filterFieldList.on("change",function(){var k=[],h,g,j,l;for(h=0;h<f._results[0].results.rows.length;h++){k.push(f._results[0].results.rows[h][this.value])}g=k.filter(onlyUnique);j='<option value="false">none</option>';if(g[0]!==e){for(h=0;h<g.length;h++){if(g[h]!=""){j+='<option value="'+g[h]+'">'+g[h]+"</option>"}}}f._filterValueList.html(j);f._flotData=[];for(h=0;h<f.options.scenarios.length;h++){l=f.generateFlotData([f._results[h]],[f.options.fieldName],"Time",{EcoregionName:["inactiv","inactive"],Ecoregion:["inactiv","inactive"]},{},"NumSites",1);f._flotData.push({label:landisMetadata.getScenarioAttributeById(f.options.scenarios[h],"name"),data:l})}f._flot.setData(f._flotData);f._flot.draw()});f._filterValueList.on("change",function(){var j={},g,h;if(f._filterFieldList.val()!="false"&&this.value!="false"){j[f._filterFieldList.val()]=this.value}f._flotData=[];for(g=0;g<f.options.scenarios.length;g++){h=f.generateFlotData([f._results[g]],[f.options.fieldName],"Time",{EcoregionName:["inactiv","inactive"],Ecoregion:["inactiv","inactive"]},j,"NumSites",1);f._flotData.push({label:landisMetadata.getScenarioAttributeById(f.options.scenarios[g],"name"),data:h})}f._flot.setData(f._flotData);f._flot.draw()})},loadData:function(){var f=this,h,g;d.ajaxSetup({async:false});for(s in f.options.scenarios){h=landisSettings.settings.landisdata.path+"/"+landisSettings.settings.landisdata.modeldata+"/"+f.options.scenarios[s]+"/"+f.options.extensionId+"/"+f.options.outputId+"/"+f.options.outputId+".csv";d.get(h).always(function(n){var j=d.parse(n,{delimiter:",",header:true,dynamicTyping:true,trimWhite:true}),l,k;l=1;k=f.generateFlotData([j],[f.options.fieldName],"Time",{EcoregionName:["inactiv","inactive"],Ecoregion:["inactiv","inactive"]},{},"NumSites",l);f._flotData.push({label:landisMetadata.getScenarioAttributeById(f.options.scenarios[s],"name"),data:k});f.drawChart();f._results.push(j)})}g='<option value="false">none</option>';for(i=0;i<f._results[0].results.fields.length;i++){if(f._results[0].results.fields[i]!=""){g+='<option value="'+f._results[0].results.fields[i]+'">'+f._results[0].results.fields[i]+"</option>"}}f._filterFieldList.append(g)},generateFlotData:function(z,w,v,j,C,E,l){var x=[],t,o,n,k,A,B,q,f,g,D,h,u;for(t=0;t<w.length;t++){o=[];for(n=0;n<z.length;n++){k={};A=[];B=false;u=0;for(q=0;q<z[n].results.rows.length;q++){f=false;for(field in j){for(var y=0;y<j[field].length;y++){if(z[n].results.rows[q][field]==j[field][y]){f=true}}}g=true;if(!jQuery.isEmptyObject(C)){for(field in C){if(z[n].results.rows[q][field]==C[field]){g=true}else{g=false}}}else{g=true}if(!f&&g){D=z[n].results.rows[q][w[t]];h=1;if(jQuery.isEmptyObject(C)&&jQuery.inArray(E,z[n].results.fields)>-1){h=z[n].results.rows[q][E];u+=h;B=true}if(z[n].results.rows[q][v] in k){k[z[n].results.rows[q][v]]+=D*l*h}else{k[z[n].results.rows[q][v]]=D*l*h}}}u/=Object.keys(k).length;for(timestep in k){if(B){k[timestep]/=u}A.push([parseFloat(timestep),k[timestep]])}o.push(A)}x.push(o)}return A},drawChart:function(){var f=this;f._flot=d.plot(d("#chart-"+f.options.chartId),f._flotData,f._flotOptions);f._flot.setCrosshairTime({x:d("#TimeControl").timeControl("option","currentTime"),y:-1})},updateTime:function(){var f=this;f._flot.setCrosshairTime({x:d("#TimeControl").timeControl("option","currentTime"),y:-1})},updateChartData:function(k){var h=this,j=[],g,f=false;for(os in h.options.scenarios){g=-1;for(ns in k){if(k[ns]==h.options.scenarios[os]){g=os;break}}if(g===-1){j.push(os);f=true}}j.sort();j.reverse();for(dataSeries in j){h.options.scenarios.splice(j[dataSeries],1)}for(ns in k){g=-1;for(os in h.options.scenarios){if(k[ns]==h.options.scenarios[os]){g=ns;break}}if(g===-1){h.options.scenarios.push(k[ns]);f=true}}if(f){h._results=[];h._flotData=[];h.loadData()}}})})(jQuery,window,document);(function(d,b,a,e){d.widget("landis.rastermap",{options:{dataPath:"",mapId:"",scenarioId:"",timeInterval:1,hiddenUIContainer:"body"},_create:function(){this.element.addClass("raster-map");this._visibleIdx=0;this._hiddenIdx=1;this._setOptions({dataPath:this.options.dataPath,mapId:this.options.mapId,scenarioId:this.options.scenarioId,timeInterval:this.options.timeInterval,hiddenUIContainer:this.options.hiddenUIContainer});this._setupUserInerfaceAndEvents();this._setupDataLayer()},_destroy:function(){this.element.removeClass("raster-map");this.element.remove();this._super()},_setOption:function(h,k){var g=this,j=this.options[h],f={scenarioMax:function(){g._updateUI()}};this._super(h,k);if(h in f){f[h]();this._triggerOptionChanged(h,j,k)}},_triggerOptionChanged:function(g,f,h){this._trigger("setOption",{type:"setOption"},{option:g,previous:f,current:h})},_setupUserInerfaceAndEvents:function(){var f=this;f._mapBoxHeader=d("<div>").addClass("mapbox-header").text(landisMetadata.getScenarioAttributeById(f.options.scenarioId,"name")).appendTo(f.element);f._mapBox=d("<div>").attr("id","rastermap-"+f.options.mapId).addClass("mapbox").appendTo(f.element)},updateTimeSeriesLayerMinMax:function(f,k,l,j){var g=this,h;for(h=0;h<g._timeSeriesLayer.length;h++){g._timeSeriesLayer[h].setMinValue(f);g._timeSeriesLayer[h].setMaxValue(k);g._timeSeriesLayer[h].setMinVisible(l);g._timeSeriesLayer[h].setMaxVisible(j)}},updateTimeSeriesLayerColorRamp:function(h){var f=this,g;g=f._olMap.getLayers();g.getAt(2).setColorRamp(h);inactiveLayer=g.getAt(0).setColorRamp(h)},setGdalDataType:function(h){var f=this,g;for(g=0;g<f._timeSeriesLayer.length;g++){f._timeSeriesLayer[g].setDataType(h)}},updateSize:function(){var f=this;f._olMap.updateSize()},_setupDataLayer:function(){var h=this,g,k,j,l,f;h._timeSeriesSource=[];h._timeSeriesLayer=[];h._currentTime=d("#TimeControl").timeControl("option","currentTime");h._prevTime=d("#TimeControl").timeControl("option","currentTime");h.basePath=landisSettings.settings.landisdata.path+"/"+landisSettings.settings.landisdata.modeldata;g=this.options.timeInterval;k=Math.floor(h._currentTime/g)*g;for(j=k;j<=k+g;j+=g){h._timeSeriesSource.push(new ol.source.XYZ({url:location.href.substring(0,location.href.lastIndexOf("/"))+"/"+h.basePath+"/"+h.options.dataPath+"/"+j+"/{z}/{x}/{y}.png"}));h._timeSeriesLayer.push(new ol.layer.Tile({source:h._timeSeriesSource[h._timeSeriesSource.length-1]}));l=new Array(255,255,178,255,254,204,92,255,253,141,60,255,240,59,32,255,189,0,38,255);f=new Uint8Array(l);h._timeSeriesLayer[h._timeSeriesLayer.length-1].setSaturation(1);h._timeSeriesLayer[h._timeSeriesLayer.length-1].setColorRamp(f)}},updateDataLayer:function(){var p=this,g,h,j,k,l,n,f,o;p._currentTime=d("#TimeControl").timeControl("option","currentTime");g=d("#TimeControl").timeControl("option","timeMax");h=p.options.timeInterval;j=Math.floor(p._currentTime/h)*h;k=d("#TimeControl").timeControl("isPlaying");if(k){if(j!=p._prevTime){l=p._hiddenIdx;p._hiddenIdx=p._visibleIdx;p._visibleIdx=l;n=p._olMap.getLayers();f=n.getAt(0);o=n.getAt(2);n.setAt(2,f);n.setAt(0,o);if(j<g){p._timeSeriesSource[p._hiddenIdx].setUrl(location.href.substring(0,location.href.lastIndexOf("/"))+"/"+p.basePath+"/"+p.options.dataPath+"/"+(j+h)+"/{z}/{x}/{y}.png")}else{d("#TimeControl").timeControl("stopPlayback")}}}else{p._timeSeriesSource[p._visibleIdx].setUrl(location.href.substring(0,location.href.lastIndexOf("/"))+"/"+p.basePath+"/"+p.options.dataPath+"/"+j+"/{z}/{x}/{y}.png");if(j<g){p._timeSeriesSource[p._hiddenIdx].setUrl(location.href.substring(0,location.href.lastIndexOf("/"))+"/"+p.basePath+"/"+p.options.dataPath+"/"+(j+h)+"/{z}/{x}/{y}.png")}p.updateSize()}p._prevTime=j},getView:function(){var f=this},drawMap:function(f){var g=this,h=landisSettings.settings.map;g._olMap=new ol.Map({renderer:ol.RendererHint.WEBGL,target:g._mapBox.prop("id"),layers:[g._timeSeriesLayer[g._hiddenIdx],f,g._timeSeriesLayer[g._visibleIdx]],view:new ol.View2D({center:h.center,resolution:h.resolution,resolutions:h.resolutions,extent:h.extent}),controls:ol.control.defaults().extend([new ol.control.ScaleLine()])});return g._olMap},getMapObject:function(){return self._olMap},bindView:function(g){var f=this;f._olMap.bindTo("view",g)},_setupEvents:function(){return}})})(jQuery,window,document);var T_CURRENTTIME="currentTime",T_CHANGESCENARIOS="changeScenarios",T_CHANGEMAPS="changeMaps",T_CHANGECHARTS="changeCharts",T_STOPPLAYBACK="stopPlayback",T_COLORRAMP="updateColorRamp",T_MINMAX="updateMinMax",updateCurrentTime=function(a,b){landisCharts.updateTime();landisMaps.updateTime()},updateColorRamp=function(a,b){landisMaps.updateColorRamp(b)},updateMinMax=function(a,b){landisMaps.updateMinMax(b)},changeScenarios=function(j,f){var a=$("#ScenarioSelector"),k=$("#TimeControl"),o=$("#MapSelector"),g=a.scenarioSelector("option","selectedScenarioIds"),l=k.timeControl("option","timeMin"),b=k.timeControl("option","timeMax"),n=landisMetadata.getScenarioAttributeById(g[0],"timeMin"),d=landisMetadata.getScenarioAttributeById(g[0],"timeMax"),e,h;if(g.length>1){for(e=1;e<g.length;e++){n=Math.min(n,landisMetadata.getScenarioAttributeById(g[e],"timeMin"));d=Math.max(d,landisMetadata.getScenarioAttributeById(g[e],"timeMax"))}}if(l!=n){k.timeControl("option","timeMin",n)}if(b!=d){k.timeControl("option","timeMax",d)}h=2;if(g.length<2){h=4}else{if(g.length>2){h=1}}o.mapSelector("option","parameterLimit",h);mapsToDraw();chartsToDraw();landisMaps.unsyncMapGroups();landisMaps.checkMapSync()},changeMaps=function(d,g){var b=$("#ScenarioSelector"),f=$("#MapSelector"),a=f.mapSelector("option","selectedParameterIds"),e=2;if(a.length<2){e=4}else{if(a.length>2){e=1}}b.scenarioSelector("option","scenarioMax",e);mapsToDraw();updateTimeInterval();landisMaps.unsyncMapGroups();landisMaps.checkMapSync()},changeCharts=function(a,b){chartsToDraw();updateTimeInterval()},stopPlayback=function(b,d){var a=$("#TimeControl");a.timeControl("stopPlayback")},mapsToDraw=function(){var a=$("#ScenarioSelector"),l=$("#MapSelector"),b=a.scenarioSelector("option","selectedScenarioIds"),f=l.mapSelector("option","selectedParameterIds"),e=[],h,d,k,g;for(h=0;h<f.length;h++){d={};d.extension=f[h][0];d.output=f[h][1];k=[];for(g=0;g<b.length;g++){k.push(b[g])}d.scenarios=k;e.push(d)}landisMaps.checkMapCandidates(e);landisMaps.bindViewsToFirstMap();landisMaps.rearangeMapsInMapGroup()},chartsToDraw=function(){var b=$("#ScenarioSelector"),k=$("#ChartSelector"),d=b.scenarioSelector("option","selectedScenarioIds"),l=k.chartSelector("option","selectedParameterIds"),a=[],f,h,g,e;for(f=0;f<l.length;f++){h={};h.extension=l[f][0];h.output=l[f][1];h.field=l[f][2];g=[];for(e=0;e<d.length;e++){g.push(d[e])}h.scenarios=g;a.push(h)}landisCharts.checkChartCandidates(a)},updateTimeInterval=function(){var f=$("#MapSelector"),a=$("#TimeControl"),b=$("#ChartSelector"),g=(f.mapSelector("option","selectedParameterIds")).concat(b.chartSelector("option","selectedParameterIds")),e=[],d;for(d=0;d<g.length;d++){e.push(landisMetadata.getExtensionAttributeById(g[d][0],"timeInterval"))}a.timeControl("option","timeInterval",mdc(e))};function setupPubSubSystem(){$.pubsub("subscribe",T_CURRENTTIME,updateCurrentTime);$.pubsub("subscribe",T_CHANGESCENARIOS,changeScenarios);$.pubsub("subscribe",T_CHANGEMAPS,changeMaps);$.pubsub("subscribe",T_CHANGECHARTS,changeCharts);$.pubsub("subscribe",T_STOPPLAYBACK,stopPlayback);$.pubsub("subscribe",T_COLORRAMP,updateColorRamp);$.pubsub("subscribe",T_MINMAX,updateMinMax)}var landisMetadata,landisMaps,landisCharts,landisSettings,mapSync=false;$(document).ready(function(){landisSettings=$.landisSettings();landisSettings.setProjectName();setupPubSubSystem();landisMaps=$.landisMaps();landisCharts=$.landisCharts();landisMetadata=$.landisMetadata();$("#TimeControl").timeControl({currentTime:landisSettings.settings.playback.time,playbackSpeed:landisSettings.settings.playback.speed,snapToInterval:landisSettings.settings.playback.snap,hiddenUIContainer:"#HiddenUIContainer"});$("#ScenarioSelector").scenarioSelector({scenarios:landisMetadata.publishScenarios(["id","name"]),hiddenUIContainer:"#HiddenUIContainer"});$("#MapSelector").mapSelector({mapoutputs:landisMetadata.publishMapOutputs(),hiddenUIContainer:"#HiddenUIContainer"});$("#ChartSelector").chartSelector({chartoutputs:landisMetadata.publishTableOutputs(),hiddenUIContainer:"#HiddenUIContainer"})});$(document).ready(function(){$("#toggleFullscreen").on("click",function(a){$(document).toggleFullScreen()});$(document).bind("fullscreenchange",function(){if($(document).fullScreen()){$("#toggleFullscreen").addClass("isFull")}else{$("#toggleFullscreen").removeClass("isFull")}});$("#syncMapGroupsByUnit").on("click",function(a){if($(this).hasClass("syncAble")){if(!$(this).hasClass("isSynced")){landisMaps.syncMapGroupsByUnit();$(this).addClass("isSynced")}else{landisMaps.unsyncMapGroups();$(this).removeClass("isSynced")}}})});$(window).resize(function(){arrangeApplicationData()});var arrangeApplicationData=function(){var e=$("#ApplicationData"),h=$("#MapContainer"),a=$("#ChartContainer"),g=$(window).height()-$("#ApplicationControl").outerHeight(),b=$(window).width(),d=b/g,j,f;e.css({height:g,width:b});j=h.find(".map-group-container");f=a.find(".chart-vis-container");if(j.length>0&&f.length==0){h.css({height:g,width:b});a.css({height:0,width:0});j.each(function(){switch(j.length){case 1:$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth());break;case 2:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth()*0.5-0.5);if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}break;case 3:case 4:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight()*0.5);$(this).outerWidth(h.outerWidth()*0.5-0.5);break}})}else{if(j.length==0&&f.length>0){h.css({height:0,width:0});a.css({height:g,width:b});f.each(function(){switch(f.length){case 1:$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth());break;case 2:$(this).css({"float":"left"});$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth()*0.5-0.5);if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}break;case 3:case 4:$(this).css({"float":"left"});$(this).outerHeight(a.outerHeight()*0.5);$(this).outerWidth(a.outerWidth()*0.5-0.5);break}})}else{if(j.length>0&&f.length>0){if(d>1.6){h.css({height:g,width:b*0.7,"float":"left"});a.css({height:g,width:b*0.3,"float":"left"});j.each(function(){switch(j.length){case 1:$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth());break;case 2:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth()*0.5-0.5);if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}break;case 3:case 4:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight()*0.5);$(this).outerWidth(h.outerWidth()*0.5-0.5);break}});f.each(function(){if(a.outerWidth()/a.outerHeight()>=0.9){$(this).css({"float":"left"});if(f.length==1){$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth());if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}}else{if(f.length==2){$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth()*0.5-0.5);if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}}else{if(f.length>2){$(this).outerHeight(a.outerHeight()*0.5);$(this).outerWidth(a.outerWidth()*0.5-0.5)}}}}else{$(this).outerHeight(a.outerHeight()/f.length);$(this).outerWidth(a.outerWidth());if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}}})}else{h.css({height:g*0.65,width:b});a.css({height:g*0.35,width:b});j.each(function(){switch(j.length){case 1:$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth());break;case 2:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth()*0.5-0.5);break;case 3:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight());$(this).outerWidth(h.outerWidth()/3);break;case 4:$(this).css({"float":"left"});$(this).outerHeight(h.outerHeight()*0.5);$(this).outerWidth(h.outerWidth()*0.5-0.5);break}});f.each(function(){if(a.outerWidth()/a.outerHeight()<=2){$(this).css({"float":"left"});if(f.length==1){$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth());if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}}else{if(f.length==2){$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth()*0.5-0.5);if($(this).outerHeight()>$(this).outerWidth()){$(this).outerHeight($(this).outerWidth())}}else{if(f.length>2){$(this).outerHeight(a.outerHeight()*0.5);$(this).outerWidth(a.outerWidth()*0.5-0.5)}}}}else{$(this).css({"float":"left"});$(this).outerHeight(a.outerHeight());$(this).outerWidth(a.outerWidth()/f.length);if($(this).outerWidth()/$(this).outerHeight()>2){$(this).outerWidth($(this).outerHeight()*2)}}})}}}}landisMaps.rearangeMapsInMapGroup()};